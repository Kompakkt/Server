FROM docker.io/oven/bun:alpine AS builder

COPY . /app
WORKDIR /app
RUN bun install && bun build --compile-autoload-package-json --compile --minify --sourcemap ./src/index.ts --outfile kompakkt-server

FROM docker.io/oven/bun:alpine AS production
COPY --from=builder /app/kompakkt-server /app/kompakkt-server
EXPOSE 3030
CMD ["/app/kompakkt-server"]
